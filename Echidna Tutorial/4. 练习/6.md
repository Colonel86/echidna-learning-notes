## Setup
1. Clone the repo: git clone https://github.com/crytic/damn-vulnerable-defi-echidna
2. install the dependencies via yarn install.

## Context
è¿™é‡Œæè¿°äº†æŒ‘æˆ˜ï¼šhttps://www.damnvulnerabledefi.xyz/challenges/1.htmlï¼Œæˆ‘ä»¬å‡è®¾è¯»è€…ç†Ÿæ‚‰å®ƒã€‚

## Goals
- ä½¿ç”¨æ­£ç¡®çš„contractså’Œå¿…è¦çš„ä½™é¢è®¾ç½®æµ‹è¯•ç¯å¢ƒã€‚
- åˆ†æ test/unstoppable/unstoppable.challenge.js ä¸­çš„ before å‡½æ•°ï¼Œä»¥ç¡®å®šéœ€è¦è¿›è¡Œå“ªäº›åˆå§‹è®¾ç½®ã€‚
- æ·»åŠ ä¸€ä¸ªå±æ€§ä»¥æ£€æŸ¥ UnstoppableLender æ˜¯å¦å§‹ç»ˆå¯ä»¥æä¾›é—ªç”µè´·ã€‚
- ä½¿ç”¨å¿…è¦çš„é…ç½®é€‰é¡¹åˆ›å»ºä¸€ä¸ª config.yamlã€‚
- ä¸€æ—¦ Echidna å‘ç°é”™è¯¯ï¼Œè§£å†³é—®é¢˜ï¼Œç„¶åç”¨ Echidna é‡æ–°å°è¯•æ‚¨çš„è´¢äº§ã€‚

åªæœ‰ä»¥ä¸‹åˆåŒæ˜¯ç›¸å…³çš„ï¼š
- `contracts/DamnValuableToken.sol`
- `contracts/unstoppable/UnstoppableLender.sol`
- `contracts/unstoppable/ReceiverUnstoppable.sol`

## Hints
æˆ‘ä»¬å»ºè®®å…ˆå°è¯•ï¼Œä¸è¦é˜…è¯»ä»¥ä¸‹æç¤ºã€‚ æç¤ºåœ¨[æç¤ºåˆ†æ”¯](https://github.com/crytic/damn-vulnerable-defi-echidna/tree/hints)ä¸­ã€‚

- æˆ‘ä»¬æ­£åœ¨å¯»æ‰¾çš„invariantæ˜¯â€œæ€»æ˜¯å¯ä»¥è¿›è¡Œé—ªç”µè´·â€
- é˜…è¯»ä»€ä¹ˆæ˜¯[multi abi option](https://github.com/crytic/building-secure-contracts/blob/master/program-analysis/echidna/common-testing-approaches.md#external-testing)
- å¿…é¡»å®ç° `receiveTokens` å›è°ƒå‡½æ•°
- åœ¨[contracts/unstoppable/UnstoppableEchidna.sol](https://github.com/crytic/damn-vulnerable-defi-echidna/blob/hints/contracts/unstoppable/UnstoppableEchidna.sol) ä¸­æä¾›äº†ä¸€ä¸ªæ¨¡æ¿
- [unstoppable.yaml](https://github.com/crytic/damn-vulnerable-defi-echidna/blob/hints/unstoppable.yaml) ä¸­æä¾›äº†ä¸€ä¸ªé…ç½®æ–‡ä»¶

## Solution
This solution can be found in the [solutions branch](https://github.com/crytic/damn-vulnerable-defi-echidna/blob/solutions/contracts/unstoppable/UnstoppableEchidna.sol).

è§£å†³æ–¹æ¡ˆè§£é‡Šï¼ˆå‰é¢æœ‰å‰§é€ï¼‰
æ³¨æ„ï¼šè¯·ç¡®ä¿æ‚¨å·²å°† `solution.sol`ï¼ˆæˆ– `Unstoppable Echidna.sol`ï¼‰æ”¾ç½®åœ¨ `contracts/unstoppable` ä¸­ã€‚

unstoppableæŒ‘æˆ˜çš„ç›®æ ‡æ˜¯å®ç° `UnstoppableLender` æœ‰ä¸¤ç§è·Ÿè¸ªå…¶ä½™é¢çš„æ¨¡å¼ï¼š`poolBalance` å’Œ`damnValuableToken.balanceOf(address(this))`ã€‚

å½“æœ‰äººè°ƒç”¨ `depositTokens()` æ—¶ä¼šæ·»åŠ  `poolBalance`ã€‚

ç°åœ¨ï¼Œä¸¤ä¸ªbalanceè·Ÿè¸ªå™¨ä¸åŒæ­¥äº†ã€‚

å½“ Echidna è°ƒç”¨ `pool.flashLoan(10)` æ—¶ï¼Œ`UnstoppableLender` ä¸­çš„æ–­è¨€ `assert(poolBalance == balanceBefore)` å°†ä¸­æ–­ï¼Œpoolæ— æ³•å†æä¾›`flash loans`ã€‚

è¯·å‚é˜… Echidna çš„ä»¥ä¸‹ç¤ºä¾‹è¾“å‡ºï¼š
```
$ echidna-test . --contract UnstoppableEchidna --config unstoppable.yaml
...

echidna_testFlashLoan: failed!ğŸ’¥  
  Call sequence:
    transfer(0x62d69f6867a0a084c6d313943dc22023bc263691,1296000)

...
```

