## Setup
1. Clone the repo: git clone https://github.com/crytic/damn-vulnerable-defi-echidna
2. install the dependencies via yarn install.

## Context
这里描述了挑战：https://www.damnvulnerabledefi.xyz/challenges/1.html，我们假设读者熟悉它。

## Goals
- 使用正确的contracts和必要的余额设置测试环境。
- 分析 test/unstoppable/unstoppable.challenge.js 中的 before 函数，以确定需要进行哪些初始设置。
- 添加一个属性以检查 UnstoppableLender 是否始终可以提供闪电贷。
- 使用必要的配置选项创建一个 config.yaml。
- 一旦 Echidna 发现错误，解决问题，然后用 Echidna 重新尝试您的财产。

只有以下合同是相关的：
- `contracts/DamnValuableToken.sol`
- `contracts/unstoppable/UnstoppableLender.sol`
- `contracts/unstoppable/ReceiverUnstoppable.sol`

## Hints
我们建议先尝试，不要阅读以下提示。 提示在[提示分支](https://github.com/crytic/damn-vulnerable-defi-echidna/tree/hints)中。

- 我们正在寻找的invariant是“总是可以进行闪电贷”
- 阅读什么是[multi abi option](https://github.com/crytic/building-secure-contracts/blob/master/program-analysis/echidna/common-testing-approaches.md#external-testing)
- 必须实现 `receiveTokens` 回调函数
- 在[contracts/unstoppable/UnstoppableEchidna.sol](https://github.com/crytic/damn-vulnerable-defi-echidna/blob/hints/contracts/unstoppable/UnstoppableEchidna.sol) 中提供了一个模板
- [unstoppable.yaml](https://github.com/crytic/damn-vulnerable-defi-echidna/blob/hints/unstoppable.yaml) 中提供了一个配置文件

## Solution
This solution can be found in the [solutions branch](https://github.com/crytic/damn-vulnerable-defi-echidna/blob/solutions/contracts/unstoppable/UnstoppableEchidna.sol).

解决方案解释（前面有剧透）
注意：请确保您已将 `solution.sol`（或 `Unstoppable Echidna.sol`）放置在 `contracts/unstoppable` 中。

unstoppable挑战的目标是实现 `UnstoppableLender` 有两种跟踪其余额的模式：`poolBalance` 和`damnValuableToken.balanceOf(address(this))`。

当有人调用 `depositTokens()` 时会添加 `poolBalance`。

现在，两个balance跟踪器不同步了。

当 Echidna 调用 `pool.flashLoan(10)` 时，`UnstoppableLender` 中的断言 `assert(poolBalance == balanceBefore)` 将中断，pool无法再提供`flash loans`。

请参阅 Echidna 的以下示例输出：
```
$ echidna-test . --contract UnstoppableEchidna --config unstoppable.yaml
...

echidna_testFlashLoan: failed!💥  
  Call sequence:
    transfer(0x62d69f6867a0a084c6d313943dc22023bc263691,1296000)

...
```

