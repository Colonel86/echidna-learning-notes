## ä»‹ç»
æˆ‘ä»¬å°†çœ‹åˆ°å¦‚ä½•æ”¶é›†å’Œä½¿ç”¨ Echidna çš„äº¤æ˜“è¯­æ–™åº“ã€‚ ç›®æ ‡æ˜¯ä»¥ä¸‹æ™ºèƒ½åˆçº¦ï¼ˆ[example/magic.sol](https://github.com/crytic/building-secure-contracts/blob/master/program-analysis/echidna/example/magic.sol)ï¼‰ï¼š
```
contract C {
  bool value_found = false;
  function magic(uint magic_1, uint magic_2, uint magic_3, uint magic_4) public {
    require(magic_1 == 42);
    require(magic_2 == 129);
    require(magic_3 == magic_4+333);
    value_found = true;
    return;
  }

  function echidna_magic_values() public returns (bool) {
    return !value_found;
  }

}
```
è¿™ä¸ªå°ä¾‹å­è¿«ä½¿ Echidna æ‰¾åˆ°æŸäº›å€¼æ¥æ›´æ”¹çŠ¶æ€å˜é‡ã€‚ è¿™å¯¹äº fuzzer æ¥è¯´å¾ˆéš¾ï¼ˆæ¨èä½¿ç”¨åƒ Manticore è¿™æ ·çš„ç¬¦å·æ‰§è¡Œå·¥å…·ï¼‰ã€‚ æˆ‘ä»¬å¯ä»¥è¿è¡Œ Echidna æ¥éªŒè¯è¿™ä¸€ç‚¹ï¼š
```
$ echidna-test magic.sol 
...

echidna_magic_values: passed! ğŸ‰

Seed: 2221503356319272685
```
ä½†æ˜¯ï¼Œåœ¨è¿è¡Œè¿™ä¸ª fuzzing æ´»åŠ¨æ—¶ï¼Œæˆ‘ä»¬ä»ç„¶å¯ä»¥ä½¿ç”¨ Echidna æ¥æ”¶é›†è¯­æ–™åº“ã€‚
## æ”¶é›†è¯­æ–™åº“
è¦å¯ç”¨è¯­æ–™åº“é›†åˆï¼Œè¯·åˆ›å»ºè¯­æ–™åº“ç›®å½•ï¼š
```
mkdir corpus-magic
```
è¿˜æœ‰ä¸€ä¸ª Echidna é…ç½®æ–‡ä»¶ config.yamlï¼š
```
corpusDir: "corpus-magic"
```
ç°åœ¨æˆ‘ä»¬å¯ä»¥è¿è¡Œæˆ‘ä»¬çš„å·¥å…·å¹¶æ£€æŸ¥æ”¶é›†çš„è¯­æ–™åº“ï¼š
```
echidna-test magic.sol --config config.yaml
```
Echidnaä»ç„¶æ‰¾ä¸åˆ°æ­£ç¡®çš„magic valueã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡æŸ¥çœ‹ corpus-magic/covered.*.txt æ–‡ä»¶æ¥éªŒè¯å®ƒå¡åœ¨å“ªé‡Œï¼š
```
r   |contract C {
  bool value_found = false;
r   |  function magic(uint magic_1, uint magic_2, uint magic_3, uint magic_4) public {
r   |    require(magic_1 == 42);
r   |    require(magic_2 == 129);
r   |    require(magic_3 == magic_4+333);
    value_found = true;
    return;
  }

  function echidna_magic_values() public returns (bool) {
    return !value_found;
  }

}
```
æ¯è¡Œå·¦ä¾§çš„æ ‡ç­¾ `r` è¡¨æ˜ Echidna èƒ½å¤Ÿåˆ°è¾¾è¿™äº›è¡Œï¼Œä½†å®ƒä»¥è¿˜åŸç»“æŸã€‚ å¦‚æ‚¨æ‰€è§ï¼Œæ¨¡ç³Šå™¨åœ¨æœ€åä¸€ä¸ª`require`å¤„å¡ä½äº†ã€‚

è¦æ‰¾åˆ°è§£å†³æ–¹æ³•ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å®ƒæ”¶é›†çš„è¯­æ–™åº“ã€‚ ä¾‹å¦‚ï¼Œè¿™äº›æ–‡ä»¶ä¹‹ä¸€æ˜¯ï¼š
```
[
   {
      "_gas'" : "0xffffffff",
      "_delay" : [
         "0x13647",
         "0xccf6"
      ],
      "_src" : "00a329c0648769a73afac7f9381e08fb43dbea70",
      "_dst" : "00a329c0648769a73afac7f9381e08fb43dbea72",
      "_value" : "0x0",
      "_call" : {
         "tag" : "SolCall",
         "contents" : [
            "magic",
            [
               {
                  "contents" : [
                     256,
                     "93723985220345906694500679277863898678726808528711107336895287282192244575836"
                  ],
                  "tag" : "AbiUInt"
               },
               {
                  "contents" : [
                     256,
                     "334"
                  ],
                  "tag" : "AbiUInt"
               },
               {
                  "contents" : [
                     256,
                     "68093943901352437066264791224433559271778087297543421781073458233697135179558"
                  ],
                  "tag" : "AbiUInt"
               },
               {
                  "tag" : "AbiUInt",
                  "contents" : [
                     256,
                     "332"
                  ]
               }
            ]
         ]
      },
      "_gasprice'" : "0xa904461f1"
   }
]
```
æ˜¾ç„¶ï¼Œè¿™ä¸ªè¾“å…¥ä¸ä¼šè§¦å‘æˆ‘ä»¬propertyçš„å¤±è´¥ã€‚ åœ¨ä¸‹ä¸€æ­¥ä¸­ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°å¦‚ä½•ä¸ºæ­¤è¿›è¡Œä¿®æ”¹ã€‚

## æ’­ç§è¯­æ–™åº“
Echidnaéœ€è¦ä¸€äº›å¸®åŠ©æ¥å¤„ç†`magic`åŠŸèƒ½ã€‚ æˆ‘ä»¬å°†å¤åˆ¶å’Œä¿®æ”¹è¾“å…¥ä»¥ä½¿ç”¨åˆé€‚çš„å‚æ•°ï¼š
```
cp corpus-magic/coverage/2712688662897926208.txt corpus-magic/coverage/new.txt
```
æˆ‘ä»¬å°†ä¿®æ”¹ new.txt ä»¥è°ƒç”¨ magic(42,129,333,0)ã€‚ ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥é‡æ–°è¿è¡Œ Echidnaï¼š
```
$ echidna-test magic.sol --config config.yaml 
...
echidna_magic_values: failed!ğŸ’¥  
  Call sequence:
    magic(42,129,333,0)


Unique instructions: 142
Unique codehashes: 1
Seed: -7293830866560616537
```
è¿™ä¸€æ¬¡ï¼Œè´¢äº§ç«‹å³å—åˆ°ä¾µçŠ¯ã€‚ æˆ‘ä»¬å¯ä»¥éªŒè¯æ˜¯å¦åˆ›å»ºäº†å¦ä¸€ä¸ªè¢«è¦†ç›–çš„.*.txt æ–‡ä»¶ï¼Œå…¶ä¸­æ˜¾ç¤ºäº† Echidna æ‰§è¡Œçš„å¦ä¸€ä¸ªè·Ÿè¸ªï¼ˆæ ‡æœ‰ *ï¼‰ï¼Œè¯¥è·Ÿè¸ªåœ¨magicå‡½æ•°ç»“æŸæ—¶ä»¥ return ç»“æŸã€‚
```
*r  |contract C {
  bool value_found = false;
*r  |  function magic(uint magic_1, uint magic_2, uint magic_3, uint magic_4) public {
*r  |    require(magic_1 == 42);
*r  |    require(magic_2 == 129);
*r  |    require(magic_3 == magic_4+333);
*   |    value_found = true;
    return;
  }

  function echidna_magic_values() public returns (bool) {
    return !value_found;
  }
}
```